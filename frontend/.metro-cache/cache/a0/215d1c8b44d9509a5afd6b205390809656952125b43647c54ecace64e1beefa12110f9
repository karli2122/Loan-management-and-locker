{"dependencies":[{"name":"@react-native-async-storage/async-storage","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":69,"index":69}}],"key":"0kSRlooyBOaYM9tlTtK91nq+uds=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/Alert","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"PEUC6jrQVoAGZ2qYkvimljMOyJI=","exportNames":["*"],"imports":1}},{"name":"../constants/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":108},"end":{"line":3,"column":39,"index":147}}],"key":"ZV0ujAFjHVGmM4aJSYIlDaiTRjE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.getAuthInfo = getAuthInfo;\n  exports.handleAuthFailure = handleAuthFailure;\n  exports.authFetch = authFetch;\n  exports.verifyTokenSilent = verifyTokenSilent;\n  var _reactNativeAsyncStorageAsyncStorage = require(_dependencyMap[0], \"@react-native-async-storage/async-storage\");\n  var AsyncStorage = _interopDefault(_reactNativeAsyncStorageAsyncStorage);\n  var _reactNativeWebDistExportsAlert = require(_dependencyMap[1], \"react-native-web/dist/exports/Alert\");\n  var Alert = _interopDefault(_reactNativeWebDistExportsAlert);\n  var _constantsApi = require(_dependencyMap[2], \"../constants/api\");\n  var API_URL = _interopDefault(_constantsApi);\n  /**\n   * Shared admin authentication utilities.\n   * Centralises token retrieval, validation, and 401 handling\n   * so every admin screen behaves consistently.\n   */\n\n  /**\n   * Retrieve the current admin token and id from storage.\n   * Returns null if either value is missing.\n   */\n  async function getAuthInfo() {\n    const token = await AsyncStorage.default.getItem('admin_token');\n    const adminId = await AsyncStorage.default.getItem('admin_id');\n    if (!token || !adminId) return null;\n    return {\n      token,\n      adminId\n    };\n  }\n\n  /**\n   * Handles a 401/auth error by clearing stored credentials and navigating to login.\n   * @param router  expo-router instance\n   * @param language current language code ('et' | 'en')\n   */\n  async function handleAuthFailure(router, language = 'en') {\n    await AsyncStorage.default.multiRemove(['admin_token', 'admin_id', 'admin_stay_signed_in']);\n    Alert.default.alert(language === 'et' ? 'Seanss aegunud' : 'Session Expired', language === 'et' ? 'Palun logige uuesti sisse' : 'Please log in again', [{\n      text: 'OK',\n      onPress: () => router.replace('/admin/login')\n    }]);\n  }\n\n  /**\n   * Wrapper around fetch that automatically handles 401 responses.\n   * Returns the Response object on success, or null when a 401 triggers re-login.\n   */\n  async function authFetch(url, options, router, language = 'en') {\n    const response = await fetch(url, options);\n    if (response.status === 401) {\n      await handleAuthFailure(router, language);\n      return null;\n    }\n    return response;\n  }\n\n  /**\n   * Silently verify the stored token against the backend.\n   * Returns true if valid, false otherwise. Does NOT redirect.\n   */\n  async function verifyTokenSilent() {\n    try {\n      const token = await AsyncStorage.default.getItem('admin_token');\n      if (!token) return false;\n      const res = await fetch(`${API_URL.default}/api/admin/verify/${token}`);\n      return res.ok;\n    } catch {\n      // Network error â€” treat as \"unknown\", don't invalidate\n      return true;\n    }\n  }\n});","lineCount":83,"map":[[12,2,20,0,"exports"],[12,9,20,0],[12,10,20,0,"getAuthInfo"],[12,21,20,0],[12,24,20,0,"getAuthInfo"],[12,35,20,0],[13,2,32,0,"exports"],[13,9,32,0],[13,10,32,0,"handleAuthFailure"],[13,27,32,0],[13,30,32,0,"handleAuthFailure"],[13,47,32,0],[14,2,54,0,"exports"],[14,9,54,0],[14,10,54,0,"authFetch"],[14,19,54,0],[14,22,54,0,"authFetch"],[14,31,54,0],[15,2,72,0,"exports"],[15,9,72,0],[15,10,72,0,"verifyTokenSilent"],[15,27,72,0],[15,30,72,0,"verifyTokenSilent"],[15,47,72,0],[16,2,1,0],[16,6,1,0,"_reactNativeAsyncStorageAsyncStorage"],[16,42,1,0],[16,45,1,0,"require"],[16,52,1,0],[16,53,1,0,"_dependencyMap"],[16,67,1,0],[17,2,1,0],[17,6,1,0,"AsyncStorage"],[17,18,1,0],[17,21,1,0,"_interopDefault"],[17,36,1,0],[17,37,1,0,"_reactNativeAsyncStorageAsyncStorage"],[17,73,1,0],[18,2,1,69],[18,6,1,69,"_reactNativeWebDistExportsAlert"],[18,37,1,69],[18,40,1,69,"require"],[18,47,1,69],[18,48,1,69,"_dependencyMap"],[18,62,1,69],[19,2,1,69],[19,6,1,69,"Alert"],[19,11,1,69],[19,14,1,69,"_interopDefault"],[19,29,1,69],[19,30,1,69,"_reactNativeWebDistExportsAlert"],[19,61,1,69],[20,2,3,0],[20,6,3,0,"_constantsApi"],[20,19,3,0],[20,22,3,0,"require"],[20,29,3,0],[20,30,3,0,"_dependencyMap"],[20,44,3,0],[21,2,3,0],[21,6,3,0,"API_URL"],[21,13,3,0],[21,16,3,0,"_interopDefault"],[21,31,3,0],[21,32,3,0,"_constantsApi"],[21,45,3,0],[22,2,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[26,0,9,0],[28,2,16,0],[29,0,17,0],[30,0,18,0],[31,0,19,0],[32,2,20,7],[32,17,20,22,"getAuthInfo"],[32,28,20,33,"getAuthInfo"],[32,29,20,33],[32,31,20,62],[33,4,21,2],[33,10,21,8,"token"],[33,15,21,13],[33,18,21,16],[33,24,21,22,"AsyncStorage"],[33,36,21,34],[33,37,21,34,"default"],[33,44,21,34],[33,45,21,35,"getItem"],[33,52,21,42],[33,53,21,43],[33,66,21,56],[33,67,21,57],[34,4,22,2],[34,10,22,8,"adminId"],[34,17,22,15],[34,20,22,18],[34,26,22,24,"AsyncStorage"],[34,38,22,36],[34,39,22,36,"default"],[34,46,22,36],[34,47,22,37,"getItem"],[34,54,22,44],[34,55,22,45],[34,65,22,55],[34,66,22,56],[35,4,23,2],[35,8,23,6],[35,9,23,7,"token"],[35,14,23,12],[35,18,23,16],[35,19,23,17,"adminId"],[35,26,23,24],[35,28,23,26],[35,35,23,33],[35,39,23,37],[36,4,24,2],[36,11,24,9],[37,6,24,11,"token"],[37,11,24,16],[38,6,24,18,"adminId"],[39,4,24,26],[39,5,24,27],[40,2,25,0],[42,2,27,0],[43,0,28,0],[44,0,29,0],[45,0,30,0],[46,0,31,0],[47,2,32,7],[47,17,32,22,"handleAuthFailure"],[47,34,32,39,"handleAuthFailure"],[47,35,33,2,"router"],[47,41,33,45],[47,43,34,2,"language"],[47,51,34,18],[47,54,34,21],[47,58,34,25],[47,60,35,2],[48,4,36,2],[48,10,36,8,"AsyncStorage"],[48,22,36,20],[48,23,36,20,"default"],[48,30,36,20],[48,31,36,21,"multiRemove"],[48,42,36,32],[48,43,36,33],[48,44,37,4],[48,57,37,17],[48,59,38,4],[48,69,38,14],[48,71,39,4],[48,93,39,26],[48,94,40,3],[48,95,40,4],[49,4,41,2,"Alert"],[49,9,41,7],[49,10,41,7,"default"],[49,17,41,7],[49,18,41,8,"alert"],[49,23,41,13],[49,24,42,4,"language"],[49,32,42,12],[49,37,42,17],[49,41,42,21],[49,44,42,24],[49,60,42,40],[49,63,42,43],[49,80,42,60],[49,82,43,4,"language"],[49,90,43,12],[49,95,43,17],[49,99,43,21],[49,102,44,8],[49,129,44,35],[49,132,45,8],[49,153,45,29],[49,155,46,4],[49,156,46,5],[50,6,46,7,"text"],[50,10,46,11],[50,12,46,13],[50,16,46,17],[51,6,46,19,"onPress"],[51,13,46,26],[51,15,46,28,"onPress"],[51,16,46,28],[51,21,46,34,"router"],[51,27,46,40],[51,28,46,41,"replace"],[51,35,46,48],[51,36,46,49],[51,50,46,63],[52,4,46,65],[52,5,46,66],[52,6,47,2],[52,7,47,3],[53,2,48,0],[55,2,50,0],[56,0,51,0],[57,0,52,0],[58,0,53,0],[59,2,54,7],[59,17,54,22,"authFetch"],[59,26,54,31,"authFetch"],[59,27,55,2,"url"],[59,30,55,13],[59,32,56,2,"options"],[59,39,56,22],[59,41,57,2,"router"],[59,47,57,45],[59,49,58,2,"language"],[59,57,58,18],[59,60,58,21],[59,64,58,25],[59,66,59,28],[60,4,60,2],[60,10,60,8,"response"],[60,18,60,16],[60,21,60,19],[60,27,60,25,"fetch"],[60,32,60,30],[60,33,60,31,"url"],[60,36,60,34],[60,38,60,36,"options"],[60,45,60,43],[60,46,60,44],[61,4,61,2],[61,8,61,6,"response"],[61,16,61,14],[61,17,61,15,"status"],[61,23,61,21],[61,28,61,26],[61,31,61,29],[61,33,61,31],[62,6,62,4],[62,12,62,10,"handleAuthFailure"],[62,29,62,27],[62,30,62,28,"router"],[62,36,62,34],[62,38,62,36,"language"],[62,46,62,44],[62,47,62,45],[63,6,63,4],[63,13,63,11],[63,17,63,15],[64,4,64,2],[65,4,65,2],[65,11,65,9,"response"],[65,19,65,17],[66,2,66,0],[68,2,68,0],[69,0,69,0],[70,0,70,0],[71,0,71,0],[72,2,72,7],[72,17,72,22,"verifyTokenSilent"],[72,34,72,39,"verifyTokenSilent"],[72,35,72,39],[72,37,72,60],[73,4,73,2],[73,8,73,6],[74,6,74,4],[74,12,74,10,"token"],[74,17,74,15],[74,20,74,18],[74,26,74,24,"AsyncStorage"],[74,38,74,36],[74,39,74,36,"default"],[74,46,74,36],[74,47,74,37,"getItem"],[74,54,74,44],[74,55,74,45],[74,68,74,58],[74,69,74,59],[75,6,75,4],[75,10,75,8],[75,11,75,9,"token"],[75,16,75,14],[75,18,75,16],[75,25,75,23],[75,30,75,28],[76,6,76,4],[76,12,76,10,"res"],[76,15,76,13],[76,18,76,16],[76,24,76,22,"fetch"],[76,29,76,27],[76,30,76,28],[76,33,76,31,"API_URL"],[76,40,76,38],[76,41,76,38,"default"],[76,48,76,38],[76,69,76,59,"token"],[76,74,76,64],[76,76,76,66],[76,77,76,67],[77,6,77,4],[77,13,77,11,"res"],[77,16,77,14],[77,17,77,15,"ok"],[77,19,77,17],[78,4,78,2],[78,5,78,3],[78,6,78,4],[78,12,78,10],[79,6,79,4],[80,6,80,4],[80,13,80,11],[80,17,80,15],[81,4,81,2],[82,2,82,0],[83,0,82,1],[83,3]],"functionMap":{"names":["<global>","getAuthInfo","handleAuthFailure","onPress","authFetch","verifyTokenSilent"],"mappings":"AAA;OCmB;CDK;OEO;4BCc,oCD;CFE;OIM;CJY;OKM;CLU"},"hasCjsExports":false},"type":"js/module"}]}